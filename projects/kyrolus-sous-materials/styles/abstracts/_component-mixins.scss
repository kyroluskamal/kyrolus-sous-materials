// =============================================================================
// KYROLUS SOUS MATERIALS - COMPONENT THEMING MIXINS
// =============================================================================
// Powerful mixins for creating themeable, accessible Angular components.
// These mixins provide consistent patterns for building UI components.
// =============================================================================

@use "sass:map";
@use "sass:color";
@use "sass:math";
@use "../tokens/primitives" as *;

// =============================================================================
// COMPONENT BASE MIXIN
// =============================================================================
/// Creates CSS custom properties for a component with sensible defaults
/// @param {String} $name - Component name (e.g., 'button', 'card')
/// @param {Map} $defaults - Default values for component properties

@mixin component-vars($name, $defaults: ()) {
  $base-defaults: (
    "bg": var(--surface),
    "color": var(--text),
    "border-color": var(--border),
    "border-width": 1px,
    "border-radius": var(--radius-md),
    "padding-x": var(--spacing-4),
    "padding-y": var(--spacing-2),
    "font-size": var(--text-base),
    "font-weight": var(--font-medium),
    "line-height": 1.5,
    "shadow": none,
    "transition": all 0.2s ease,
  );

  $merged: map.merge($base-defaults, $defaults);

  @each $prop, $value in $merged {
    --#{$name}-#{$prop}: #{$value};
  }
}

// =============================================================================
// INTERACTIVE STATES MIXIN
// =============================================================================
/// Generates hover, focus, active, and disabled states for interactive elements
/// @param {Color} $base-color - Base color for state calculations
/// @param {String} $prefix - Optional prefix for CSS custom properties

@mixin interactive-states($base-color: null, $prefix: null) {
  transition: all 0.2s ease;

  &:hover:not(:disabled):not([disabled]) {
    @if $base-color {
      background-color: color.adjust($base-color, $lightness: -5%);
    } @else {
      filter: brightness(0.95);
    }
    @content;
  }

  &:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
  }

  &:active:not(:disabled):not([disabled]) {
    @if $base-color {
      background-color: color.adjust($base-color, $lightness: -10%);
    } @else {
      filter: brightness(0.9);
    }
    transform: scale(0.98);
  }

  &:disabled,
  &[disabled],
  &[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
}

// =============================================================================
// COLOR VARIANTS MIXIN
// =============================================================================
/// Generates color variant classes for a component
/// @param {String} $property - CSS property to apply color to
/// @param {String} $prefix - Class prefix (e.g., 'btn' for .btn-primary)

@mixin color-variants($property: background-color, $prefix: "") {
  $semantic-colors: (
    "primary": var(--primary),
    "secondary": var(--secondary),
    "success": var(--success),
    "warning": var(--warning),
    "error": var(--error),
    "info": var(--info),
  );

  @each $name, $color in $semantic-colors {
    @if $prefix != "" {
      &.#{$prefix}-#{$name} {
        #{$property}: $color;
        @content;
      }
    } @else {
      &-#{$name} {
        #{$property}: $color;
        @content;
      }
    }
  }
}

// =============================================================================
// SIZE VARIANTS MIXIN
// =============================================================================
/// Generates size variant classes for a component
/// @param {String} $prefix - Class prefix

@mixin size-variants($prefix: "") {
  $sizes: (
    "xs": (
      "padding-x": var(--spacing-2),
      "padding-y": var(--spacing-1),
      "font-size": var(--text-xs),
      "min-height": 1.5rem,
    ),
    "sm": (
      "padding-x": var(--spacing-3),
      "padding-y": var(--spacing-1\.5),
      "font-size": var(--text-sm),
      "min-height": 2rem,
    ),
    "md": (
      "padding-x": var(--spacing-4),
      "padding-y": var(--spacing-2),
      "font-size": var(--text-base),
      "min-height": 2.5rem,
    ),
    "lg": (
      "padding-x": var(--spacing-6),
      "padding-y": var(--spacing-3),
      "font-size": var(--text-lg),
      "min-height": 3rem,
    ),
    "xl": (
      "padding-x": var(--spacing-8),
      "padding-y": var(--spacing-4),
      "font-size": var(--text-xl),
      "min-height": 3.5rem,
    ),
  );

  @each $size-name, $props in $sizes {
    @if $prefix != "" {
      &.#{$prefix}-#{$size-name} {
        padding: map.get($props, "padding-y") map.get($props, "padding-x");
        font-size: map.get($props, "font-size");
        min-height: map.get($props, "min-height");
        @content;
      }
    } @else {
      &-#{$size-name} {
        padding: map.get($props, "padding-y") map.get($props, "padding-x");
        font-size: map.get($props, "font-size");
        min-height: map.get($props, "min-height");
        @content;
      }
    }
  }
}

// =============================================================================
// BUTTON BASE MIXIN
// =============================================================================
/// Complete button base with all necessary styles
/// @param {Map} $options - Button configuration options

@mixin button-base($options: ()) {
  $defaults: (
    "display": inline-flex,
    "align-items": center,
    "justify-content": center,
    "gap": var(--spacing-2),
    "border-radius": var(--radius-md),
    "font-weight": var(--font-medium),
    "cursor": pointer,
    "user-select": none,
    "white-space": nowrap,
  );

  $merged: map.merge($defaults, $options);

  display: map.get($merged, "display");
  align-items: map.get($merged, "align-items");
  justify-content: map.get($merged, "justify-content");
  gap: map.get($merged, "gap");
  border-radius: map.get($merged, "border-radius");
  font-weight: map.get($merged, "font-weight");
  cursor: map.get($merged, "cursor");
  user-select: map.get($merged, "user-select");
  white-space: map.get($merged, "white-space");
  border: 1px solid transparent;
  text-decoration: none;
  position: relative;
  overflow: hidden;

  @include interactive-states;
}

// =============================================================================
// BUTTON VARIANTS MIXIN
// =============================================================================
/// Generates button style variants (solid, outline, ghost, link)

@mixin button-variants {
  // Solid (filled) variant
  &-solid,
  &.solid {
    background-color: var(--primary);
    color: var(--on-primary);
    border-color: var(--primary);

    &:hover:not(:disabled) {
      background-color: var(--primary-hover);
      border-color: var(--primary-hover);
    }

    &:active:not(:disabled) {
      background-color: var(--primary-active);
    }
  }

  // Outline variant
  &-outline,
  &.outline {
    background-color: transparent;
    color: var(--primary);
    border-color: var(--primary);

    &:hover:not(:disabled) {
      background-color: var(--primary-subtle);
    }

    &:active:not(:disabled) {
      background-color: var(--primary-subtle);
    }
  }

  // Ghost variant
  &-ghost,
  &.ghost {
    background-color: transparent;
    color: var(--text);
    border-color: transparent;

    &:hover:not(:disabled) {
      background-color: var(--surface-raised);
    }

    &:active:not(:disabled) {
      background-color: var(--surface-sunken);
    }
  }

  // Link variant
  &-link,
  &.link {
    background-color: transparent;
    color: var(--text-link);
    border-color: transparent;
    padding: 0;
    min-height: auto;

    &:hover:not(:disabled) {
      text-decoration: underline;
      background-color: transparent;
    }
  }

  // Soft/subtle variant
  &-soft,
  &.soft {
    background-color: var(--primary-subtle);
    color: var(--primary);
    border-color: transparent;

    &:hover:not(:disabled) {
      background-color: var(--primary-light);
    }
  }
}

// =============================================================================
// INPUT BASE MIXIN
// =============================================================================
/// Complete form input base with all necessary styles

@mixin input-base($options: ()) {
  $defaults: (
    "padding-x": var(--spacing-3),
    "padding-y": var(--spacing-2),
    "border-radius": var(--radius-md),
    "border-width": 1px,
    "font-size": var(--text-base),
  );

  $merged: map.merge($defaults, $options);

  display: block;
  width: 100%;
  padding: map.get($merged, "padding-y") map.get($merged, "padding-x");
  border-radius: map.get($merged, "border-radius");
  border: map.get($merged, "border-width") solid var(--border);
  background-color: var(--surface);
  color: var(--text);
  font-size: map.get($merged, "font-size");
  line-height: 1.5;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;

  &::placeholder {
    color: var(--text-muted);
  }

  &:hover:not(:disabled):not(:focus) {
    border-color: var(--border-strong);
  }

  &:focus {
    outline: none;
    border-color: var(--border-focus);
    box-shadow: 0 0 0 3px var(--primary-subtle);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: var(--surface-sunken);
  }

  &[aria-invalid="true"],
  &:invalid:not(:placeholder-shown) {
    border-color: var(--error);

    &:focus {
      box-shadow: 0 0 0 3px rgba(var(--error), 0.2);
    }
  }
}

// =============================================================================
// CARD BASE MIXIN
// =============================================================================
/// Complete card component base

@mixin card-base($options: ()) {
  $defaults: (
    "padding": var(--spacing-6),
    "border-radius": var(--radius-lg),
    "shadow": var(--shadow-md),
  );

  $merged: map.merge($defaults, $options);

  background-color: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: map.get($merged, "border-radius");
  padding: map.get($merged, "padding");
  box-shadow: map.get($merged, "shadow");
}

// =============================================================================
// FORM FIELD WRAPPER MIXIN
// =============================================================================
/// Wrapper for form fields with label, input, and helper/error text

@mixin form-field-wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-1);

  .field-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text);

    &.required::after {
      content: " *";
      color: var(--error);
    }
  }

  .field-helper {
    font-size: var(--text-xs);
    color: var(--text-muted);
  }

  .field-error {
    font-size: var(--text-xs);
    color: var(--error);
    display: flex;
    align-items: center;
    gap: var(--spacing-1);

    &::before {
      content: "âš ";
    }
  }

  &.has-error {
    .field-label {
      color: var(--error);
    }
  }
}

// =============================================================================
// FLOATING LABEL MIXIN
// =============================================================================
/// Creates floating label effect for inputs

@mixin floating-label {
  position: relative;

  .floating-input {
    @include input-base;
    padding-top: var(--spacing-5);

    &::placeholder {
      color: transparent;
    }

    &:focus::placeholder {
      color: var(--text-muted);
    }
  }

  .floating-label {
    position: absolute;
    left: var(--spacing-3);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: var(--text-base);
    pointer-events: none;
    transition: all 0.2s ease;
    background-color: var(--surface);
    padding: 0 var(--spacing-1);
  }

  .floating-input:focus ~ .floating-label,
  .floating-input:not(:placeholder-shown) ~ .floating-label {
    top: 0;
    font-size: var(--text-xs);
    color: var(--primary);
  }
}

// =============================================================================
// MODAL/DIALOG MIXIN
// =============================================================================
/// Complete modal/dialog base styles

@mixin modal-base($options: ()) {
  $defaults: (
    "max-width": 32rem,
    "padding": var(--spacing-6),
    "border-radius": var(--radius-xl),
  );

  $merged: map.merge($defaults, $options);

  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: map.get($merged, "max-width");
  width: calc(100% - var(--spacing-8));
  max-height: calc(100vh - var(--spacing-8));
  padding: map.get($merged, "padding");
  background-color: var(--surface);
  border-radius: map.get($merged, "border-radius");
  box-shadow: var(--shadow-2xl);
  z-index: var(--z-modal);
  overflow: auto;

  &:focus {
    outline: none;
  }
}

@mixin modal-backdrop {
  position: fixed;
  inset: 0;
  background-color: var(--overlay);
  z-index: var(--z-backdrop);
  animation: ks-fade-in 0.2s ease-out;
}

// =============================================================================
// DROPDOWN/POPOVER MIXIN
// =============================================================================
/// Dropdown/popover positioning and styling

@mixin dropdown-base($options: ()) {
  $defaults: (
    "min-width": 12rem,
    "border-radius": var(--radius-lg),
    "padding": var(--spacing-1),
  );

  $merged: map.merge($defaults, $options);

  position: absolute;
  min-width: map.get($merged, "min-width");
  background-color: var(--surface);
  border: 1px solid var(--border-subtle);
  border-radius: map.get($merged, "border-radius");
  padding: map.get($merged, "padding");
  box-shadow: var(--shadow-lg);
  z-index: var(--z-dropdown);
}

@mixin dropdown-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-2);
  padding: var(--spacing-2) var(--spacing-3);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background-color 0.15s ease;

  &:hover,
  &:focus {
    background-color: var(--surface-raised);
    outline: none;
  }

  &[aria-selected="true"],
  &.selected {
    background-color: var(--primary-subtle);
    color: var(--primary);
  }

  &:disabled,
  &[aria-disabled="true"] {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
}

// =============================================================================
// BADGE/TAG MIXIN
// =============================================================================
/// Badge/tag component styles

@mixin badge-base {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-1);
  padding: var(--spacing-0\.5) var(--spacing-2);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  border-radius: var(--radius-full);
  white-space: nowrap;
}

@mixin badge-variants {
  &-solid {
    background-color: var(--primary);
    color: var(--on-primary);
  }

  &-soft {
    background-color: var(--primary-subtle);
    color: var(--primary);
  }

  &-outline {
    background-color: transparent;
    border: 1px solid var(--primary);
    color: var(--primary);
  }

  &-dot {
    &::before {
      content: "";
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 50%;
      background-color: currentColor;
    }
  }
}

// =============================================================================
// AVATAR MIXIN
// =============================================================================
/// Avatar component styles

@mixin avatar-base($size: 2.5rem) {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: $size;
  height: $size;
  border-radius: var(--radius-full);
  overflow: hidden;
  background-color: var(--surface-raised);
  color: var(--text-secondary);
  font-weight: var(--font-medium);
  font-size: calc($size * 0.4);

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

@mixin avatar-sizes {
  &-xs {
    width: 1.5rem;
    height: 1.5rem;
    font-size: 0.5rem;
  }
  &-sm {
    width: 2rem;
    height: 2rem;
    font-size: 0.75rem;
  }
  &-md {
    width: 2.5rem;
    height: 2.5rem;
    font-size: 1rem;
  }
  &-lg {
    width: 3rem;
    height: 3rem;
    font-size: 1.25rem;
  }
  &-xl {
    width: 4rem;
    height: 4rem;
    font-size: 1.5rem;
  }
  &-2xl {
    width: 5rem;
    height: 5rem;
    font-size: 2rem;
  }
}

// =============================================================================
// SKELETON LOADER MIXIN
// =============================================================================
/// Skeleton loading placeholder styles

@mixin skeleton-base {
  background: linear-gradient(
    90deg,
    var(--skeleton) 0%,
    var(--skeleton-shimmer) 50%,
    var(--skeleton) 100%
  );
  background-size: 200% 100%;
  animation: ks-shimmer 1.5s infinite;
  border-radius: var(--radius-md);
}

@mixin skeleton-text($lines: 1, $last-width: 60%) {
  @include skeleton-base;

  @if $lines > 1 {
    &::after {
      content: "";
      display: block;
      @for $i from 2 through $lines {
        margin-top: var(--spacing-2);
        width: if($i == $lines, $last-width, 100%);
        height: 1em;
        @include skeleton-base;
      }
    }
  }
}

// =============================================================================
// TOOLTIP MIXIN
// =============================================================================
/// Tooltip styles

@mixin tooltip-base {
  position: absolute;
  padding: var(--spacing-1) var(--spacing-2);
  background-color: var(--color-gray-900);
  color: #ffffff;
  font-size: var(--text-xs);
  border-radius: var(--radius-md);
  white-space: nowrap;
  z-index: var(--z-tooltip);
  pointer-events: none;

  // Arrow
  &::before {
    content: "";
    position: absolute;
    border: 4px solid transparent;
  }

  // Top placement
  &[data-placement="top"] {
    &::before {
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-top-color: var(--color-gray-900);
    }
  }

  // Bottom placement
  &[data-placement="bottom"] {
    &::before {
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-bottom-color: var(--color-gray-900);
    }
  }
}

// =============================================================================
// RIPPLE EFFECT MIXIN
// =============================================================================
/// Material-style ripple effect

@mixin ripple-effect($color: currentColor) {
  position: relative;
  overflow: hidden;

  &::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    padding-bottom: 100%;
    background: $color;
    opacity: 0;
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0);
    pointer-events: none;
  }

  &:active::after {
    animation: ks-ripple 0.6s ease-out;
  }
}

// =============================================================================
// FOCUS VISIBLE MIXIN
// =============================================================================
/// Consistent focus-visible styles

@mixin focus-visible($color: var(--primary), $offset: 2px) {
  &:focus {
    outline: none;
  }

  &:focus-visible {
    outline: 2px solid $color;
    outline-offset: $offset;
  }
}

// =============================================================================
// TRUNCATE TEXT MIXIN
// =============================================================================
/// Text truncation with ellipsis

@mixin truncate($lines: 1) {
  @if $lines == 1 {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}

// =============================================================================
// SCROLLBAR STYLING MIXIN
// =============================================================================
/// Custom scrollbar styles

@mixin custom-scrollbar(
  $width: 8px,
  $track: var(--surface-sunken),
  $thumb: var(--border-strong)
) {
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }

  &::-webkit-scrollbar-track {
    background: $track;
    border-radius: var(--radius-full);
  }

  &::-webkit-scrollbar-thumb {
    background: $thumb;
    border-radius: var(--radius-full);

    &:hover {
      background: var(--text-muted);
    }
  }

  // Firefox
  scrollbar-width: thin;
  scrollbar-color: $thumb $track;
}

// =============================================================================
// VISUALLY HIDDEN MIXIN
// =============================================================================
/// Hide element visually but keep it accessible to screen readers

@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
