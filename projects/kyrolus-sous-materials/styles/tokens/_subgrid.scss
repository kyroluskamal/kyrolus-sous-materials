// =============================================================================
// CSS SUBGRID UTILITIES
// =============================================================================
// Subgrid allows child elements to inherit parent grid tracks
// Perfect for aligning nested content with outer grid structure
// Browser support: Chrome 117+, Firefox 71+, Safari 16+

// =============================================================================
// SUBGRID CONTAINER SETUP
// =============================================================================

/// Grid container with subgrid-ready structure
.grid-parent {
  display: grid;
  gap: var(--grid-gap, 1rem);
}

/// Common grid templates for parent grids
.grid-cols-subgrid-2 {
  grid-template-columns: repeat(2, 1fr);
}

.grid-cols-subgrid-3 {
  grid-template-columns: repeat(3, 1fr);
}

.grid-cols-subgrid-4 {
  grid-template-columns: repeat(4, 1fr);
}

.grid-cols-subgrid-6 {
  grid-template-columns: repeat(6, 1fr);
}

.grid-cols-subgrid-12 {
  grid-template-columns: repeat(12, 1fr);
}

.grid-rows-subgrid-2 {
  grid-template-rows: repeat(2, auto);
}

.grid-rows-subgrid-3 {
  grid-template-rows: repeat(3, auto);
}

.grid-rows-subgrid-4 {
  grid-template-rows: repeat(4, auto);
}

// =============================================================================
// SUBGRID UTILITIES
// =============================================================================

/// Inherit columns from parent grid
.subgrid-cols {
  display: grid;
  grid-template-columns: subgrid;
}

/// Inherit rows from parent grid
.subgrid-rows {
  display: grid;
  grid-template-rows: subgrid;
}

/// Inherit both columns and rows from parent grid
.subgrid {
  display: grid;
  grid-template-columns: subgrid;
  grid-template-rows: subgrid;
}

/// Subgrid with column inheritance only (explicit)
.subgrid-cols-only {
  display: grid;
  grid-template-columns: subgrid;
  grid-template-rows: auto;
}

/// Subgrid with row inheritance only (explicit)
.subgrid-rows-only {
  display: grid;
  grid-template-columns: auto;
  grid-template-rows: subgrid;
}

// =============================================================================
// SPAN UTILITIES FOR SUBGRID CHILDREN
// =============================================================================

/// Column span utilities (child must span multiple columns to use subgrid)
@for $i from 1 through 12 {
  .col-span-#{$i} {
    grid-column: span #{$i};
  }
}

.col-span-full {
  grid-column: 1 / -1;
}

/// Row span utilities
@for $i from 1 through 6 {
  .row-span-#{$i} {
    grid-row: span #{$i};
  }
}

.row-span-full {
  grid-row: 1 / -1;
}

// =============================================================================
// SUBGRID GAP UTILITIES
// =============================================================================
// Subgrid inherits gap from parent, but can be overridden

/// Inherit gap from parent (default behavior)
.subgrid-gap-inherit {
  gap: inherit;
}

/// Override gap in subgrid
.subgrid-gap-0 {
  gap: 0;
}

.subgrid-gap-1 {
  gap: 0.25rem;
}

.subgrid-gap-2 {
  gap: 0.5rem;
}

.subgrid-gap-4 {
  gap: 1rem;
}

.subgrid-gap-6 {
  gap: 1.5rem;
}

.subgrid-gap-8 {
  gap: 2rem;
}

// =============================================================================
// COMMON SUBGRID PATTERNS
// =============================================================================

/// Card grid pattern - cards align their internal sections
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
}

.card-grid-item {
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 0.75rem;
}

/// Form grid pattern - labels and inputs align across rows
.form-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 1rem 1.5rem;
  align-items: center;
}

.form-grid-row {
  display: grid;
  grid-column: 1 / -1;
  grid-template-columns: subgrid;
}

/// Table-like grid pattern
.table-grid {
  display: grid;
  grid-template-columns: repeat(var(--table-cols, 4), 1fr);
  gap: 0;
}

.table-grid-row {
  display: grid;
  grid-column: 1 / -1;
  grid-template-columns: subgrid;

  &:nth-child(even) {
    background-color: var(--surface-alt, rgba(0, 0, 0, 0.02));
  }
}

.table-grid-header {
  display: grid;
  grid-column: 1 / -1;
  grid-template-columns: subgrid;
  font-weight: 600;
  background-color: var(--surface-elevated);
  border-bottom: 1px solid var(--border);
}

/// Navigation grid pattern
.nav-grid {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 1rem;
}

.nav-grid-section {
  display: grid;
  grid-template-columns: subgrid;
}

// =============================================================================
// NESTED SUBGRID EXAMPLE PATTERNS
// =============================================================================

/// Product card with aligned sections
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 2rem;
}

.product-card {
  display: grid;
  grid-template-rows: 200px auto auto 1fr auto;
  gap: 0.75rem;

  .product-image {
    grid-row: 1;
  }

  .product-title {
    grid-row: 2;
  }

  .product-price {
    grid-row: 3;
  }

  .product-description {
    grid-row: 4;
  }

  .product-actions {
    grid-row: 5;
  }
}

/// Dashboard widget grid
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  grid-template-rows: auto;
  gap: 1.5rem;
}

.widget-small {
  grid-column: span 3;
}

.widget-medium {
  grid-column: span 6;
}

.widget-large {
  grid-column: span 9;
}

.widget-full {
  grid-column: span 12;
}

.widget-content {
  display: grid;
  grid-template-columns: subgrid;
}

// =============================================================================
// RESPONSIVE SUBGRID
// =============================================================================

/// Responsive subgrid that falls back on smaller screens
@media (max-width: 768px) {
  .subgrid-responsive {
    grid-template-columns: 1fr !important;
  }

  .subgrid-cols-responsive {
    grid-template-columns: 1fr;
  }
}

/// Container query based subgrid
@container (min-width: 400px) {
  .cq-subgrid {
    grid-template-columns: subgrid;
  }
}

// =============================================================================
// ALIGNMENT IN SUBGRID
// =============================================================================

/// Align items in subgrid cells
.subgrid-items-start {
  align-items: start;
  justify-items: start;
}

.subgrid-items-center {
  align-items: center;
  justify-items: center;
}

.subgrid-items-end {
  align-items: end;
  justify-items: end;
}

.subgrid-items-stretch {
  align-items: stretch;
  justify-items: stretch;
}

/// Baseline alignment (useful for text in subgrid)
.subgrid-items-baseline {
  align-items: baseline;
}

// =============================================================================
// SUBGRID MIXINS
// =============================================================================

/// Create subgrid container
/// @param {String} $direction - 'columns', 'rows', or 'both'
@mixin subgrid($direction: both) {
  display: grid;

  @if $direction == columns or $direction == both {
    grid-template-columns: subgrid;
  }

  @if $direction == rows or $direction == both {
    grid-template-rows: subgrid;
  }
}

/// Create parent grid with subgrid-ready children
/// @param {Number} $cols - Number of columns
/// @param {Number} $rows - Number of rows (optional)
/// @param {Length} $gap - Gap size
@mixin grid-parent($cols, $rows: null, $gap: 1rem) {
  display: grid;
  grid-template-columns: repeat($cols, 1fr);
  gap: $gap;

  @if $rows {
    grid-template-rows: repeat($rows, auto);
  }
}

/// Span and subgrid pattern
/// @param {Number} $col-span - Column span
/// @param {Number} $row-span - Row span (optional)
@mixin span-subgrid($col-span, $row-span: null) {
  grid-column: span $col-span;
  display: grid;
  grid-template-columns: subgrid;

  @if $row-span {
    grid-row: span $row-span;
    grid-template-rows: subgrid;
  }
}

// =============================================================================
// FEATURE DETECTION
// =============================================================================

/// Feature query for subgrid support
@supports (grid-template-columns: subgrid) {
  .subgrid-supported {
    --subgrid-support: true;
  }
}

/// Fallback for browsers without subgrid
@supports not (grid-template-columns: subgrid) {
  .subgrid-cols,
  .subgrid-rows,
  .subgrid {
    // Fallback to regular grid with same column count
    display: grid;
    gap: inherit;
  }

  .subgrid-fallback-2 {
    grid-template-columns: repeat(2, 1fr);
  }

  .subgrid-fallback-3 {
    grid-template-columns: repeat(3, 1fr);
  }

  .subgrid-fallback-4 {
    grid-template-columns: repeat(4, 1fr);
  }
}

// =============================================================================
// NAMED GRID LINES WITH SUBGRID
// =============================================================================

/// Grid with named lines for semantic placement
.grid-named {
  display: grid;
  grid-template-columns:
    [full-start] 1fr
    [content-start] minmax(0, 65ch)
    [content-end] 1fr
    [full-end];
}

.grid-named-content {
  grid-column: content-start / content-end;
}

.grid-named-full {
  grid-column: full-start / full-end;
}

/// Subgrid inherits named lines from parent
.subgrid-named {
  display: grid;
  grid-column: full-start / full-end;
  grid-template-columns: subgrid;
}
